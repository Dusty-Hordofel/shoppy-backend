### Anatomie des Points de Terminaison de l'API avec NestJS

Dans cette vidÃ©o, nous allons approfondir la gestion des paramÃ¨tres, des requÃªtes et des corps de requÃªtes dans NestJS. Nous allons voir comment rÃ©cupÃ©rer ces informations Ã  l'intÃ©rieur de notre contrÃ´leur.

### Gestion des ParamÃ¨tres (Params)

CommenÃ§ons par les paramÃ¨tres de route. Par exemple, si nous avons une requÃªte GET qui nÃ©cessite un ID utilisateur comme paramÃ¨tre, voici comment procÃ©der :

1. **DÃ©finir le ParamÃ¨tre dans l'URL** :

   - Supposons que notre route soit `/users/:id`, oÃ¹ `:id` est le paramÃ¨tre requis.
   - Vous pouvez rendre le paramÃ¨tre optionnel en ajoutant un point d'interrogation `?` (ex. `/users/:id?`), mais pour l'exemple, nous allons le rendre obligatoire.

2. **Gestion du ParamÃ¨tre dans le ContrÃ´leur** :
   - Importez le dÃ©corateur `@Param` depuis `@nestjs/common`.
   - Utilisez ce dÃ©corateur dans votre mÃ©thode pour accÃ©der aux paramÃ¨tres de la requÃªte.

Voici un exemple de code pour le contrÃ´leur :

```typescript
import { Controller, Get, Param } from "@nestjs/common";

@Controller("users")
export class UsersController {
  @Get(":id")
  getUsers(@Param("id") id: string): string {
    console.log(`ID: ${id}`);
    return `Vous avez envoyÃ© une requÃªte GET Ã  l'endpoint utilisateurs avec l'ID: ${id}`;
  }
}
```

3. **Tester la RequÃªte** :
   - Envoyez une requÃªte GET Ã  `/users/123` et vÃ©rifiez que l'ID est correctement rÃ©cupÃ©rÃ© et affichÃ© dans la console.

### Gestion des ParamÃ¨tres Optionnels

- Vous pouvez dÃ©finir un paramÃ¨tre comme optionnel en ajoutant un point d'interrogation dans la dÃ©finition de la route : `/users/:id?`.
- Vous pouvez tester la prÃ©sence ou l'absence du paramÃ¨tre dans le contrÃ´leur.

### Gestion des ParamÃ¨tres de RequÃªte (Query)

Pour rÃ©cupÃ©rer les paramÃ¨tres de requÃªte, utilisez le dÃ©corateur `@Query` :

1. **Importation du DÃ©corateur** :

   - Importez `@Query` depuis `@nestjs/common`.

2. **Utilisation dans le ContrÃ´leur** :

```typescript
import { Controller, Get, Query } from "@nestjs/common";

@Controller("users")
export class UsersController {
  @Get()
  getUsers(@Query() query: any): string {
    console.log(`Query: ${JSON.stringify(query)}`);
    return `Vous avez envoyÃ© une requÃªte GET avec des paramÃ¨tres de requÃªte: ${JSON.stringify(
      query
    )}`;
  }
}
```

3. **Tester la RequÃªte** :
   - Envoyez une requÃªte GET Ã  `/users?limit=10&offset=20` et vÃ©rifiez que les paramÃ¨tres de requÃªte sont correctement affichÃ©s dans la console.

### Gestion du Corps de la RequÃªte (Body)

Pour rÃ©cupÃ©rer le corps d'une requÃªte POST, utilisez le dÃ©corateur `@Body` :

1. **Importation du DÃ©corateur** :

   - Importez `@Body` depuis `@nestjs/common`.

2. **Utilisation dans le ContrÃ´leur** :

```typescript
import { Controller, Post, Body } from "@nestjs/common";

@Controller("users")
export class UsersController {
  @Post()
  createUser(@Body() body: any): string {
    console.log(`Body: ${JSON.stringify(body)}`);
    return `Vous avez envoyÃ© une requÃªte POST avec le corps: ${JSON.stringify(
      body
    )}`;
  }
}
```

3. **Tester la RequÃªte** :
   - Envoyez une requÃªte POST avec un corps JSON comme `{ "firstName": "John", "lastName": "Doe", "email": "john.doe@example.com", "password": "password123" }` et vÃ©rifiez que le corps est correctement affichÃ© dans la console.

### AccÃ¨s Direct Ã  l'Objet RequÃªte d'Express

Parfois, vous pourriez vouloir accÃ©der directement Ã  l'objet requÃªte d'Express pour des besoins spÃ©cifiques :

1. **Importation des Types** :

   - Importez `Request` depuis `express`.
   - Importez `@Req` depuis `@nestjs/common`.

2. **Utilisation dans le ContrÃ´leur** :

```typescript
import { Controller, Post, Req } from "@nestjs/common";
import { Request } from "express";

@Controller("users")
export class UsersController {
  @Post()
  createUser(@Req() req: Request): string {
    console.log(`Request: ${JSON.stringify(req.body)}`);
    return `Vous avez envoyÃ© une requÃªte POST avec le corps: ${JSON.stringify(
      req.body
    )}`;
  }
}
```

3. **Tester la RequÃªte** :
   - Envoyez une requÃªte POST comme prÃ©cÃ©demment et vÃ©rifiez que l'objet requÃªte est correctement affichÃ© dans la console.

### Conclusion

Nous avons vu comment rÃ©cupÃ©rer les paramÃ¨tres de route, les paramÃ¨tres de requÃªte et le corps des requÃªtes dans NestJS. Nous avons Ã©galement explorÃ© comment accÃ©der directement Ã  l'objet requÃªte d'Express si nÃ©cessaire. Ces outils vous permettent de gÃ©rer efficacement les donnÃ©es entrantes dans vos endpoints d'API.

Dans les prochaines vidÃ©os, nous explorerons d'autres aspects des requÃªtes et des rÃ©ponses dans NestJS. Merci de votre attention !

```ts
import {
  Body,
  Controller,
  Delete,
  Get,
  Param,
  Patch,
  Post,
  Query,
} from "@nestjs/common";

@Controller("users")
export class UsersController {
  @Get("/:id/:optionnal?")
  public getUsers(@Param() params: any, @Query() query: any) {
    console.log(params);
    console.log(query);
    return "You sent a request to the user enpoint ";
  }
  @Post()
  public createUser(@Body() request: any) {
    console.log("ğŸš€ ~ UsersController ~ createUser ~ request:", request);
    return " You sent a request to the user enpoint";
  }
}
```
